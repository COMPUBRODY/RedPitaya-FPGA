/*
 * TFT controller specific code
 */

&pinctrl0 {
	pinctrl_spi1_tft: spi1_tft {
                // SPI1 for TFT and touch
                // SPI1_MOSI - MIO[10]
                // SPI1_MISO - MIO[11]
                // SPI1_SCLK - MIO[12]
                // SPI1_SSn0 - MIO[13]
                // SPI1_SSN1 - MIO[50]
		mux_spi {
			function = "spi1";
			groups = "spi1_0_grp";
		};
                mux_ss {
			function = "spi1_ss";
			groups   = "spi1_0_ss0_grp", "spi1_3_ss1_grp";
                };
		conf_spi {
			pins = "MIO10", "MIO11", "MIO12";
			slew-rate = <1>;
			bias-disable;
			io-standard = <3>;  // LVCMOS33
		};
		conf_ss0 {
			pins = "MIO13";
			slew-rate = <0>;
			bias-pull-up;
			io-standard = <3>;  // LVCMOS33
		};
		conf_ss {
			pins = "MIO50";
			slew-rate = <0>;
			bias-pull-up;
			io-standard = <2>;  // LVCMOS25
		};
                // TFT D/C (data/control)
		mux_tft_dc {
			function = "gpio0";
			groups = "gpio0_8_grp";
		};
		conf_tft_dc {
			pins = "MIO8";
			bias-disable;
			slew-rate = <0>;
			io-standard = <3>;  // LVCMOS33
		};
		// TFT reset
		mux_tft_reset {
			function = "gpio0";
			groups = "gpio0_51_grp";
		};
		conf_tft_reset {
			pins = "MIO51";
			bias-pull-up;
			slew-rate = <0>;
			io-standard = <3>;  // LVCMOS33
		};
		// touch pendown
		mux_touch_pendow {
			function = "gpio0";
			groups = "gpio0_9_grp";
		};
		conf_touch_pendow {
			pins = "MIO9";
			bias-disable;
			slew-rate = <0>;
			io-standard = <3>;  // LVCMOS33
		};
	};
};

&spi1 {
	num-cs = <2>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_spi1_tft>;

	pitft: pitft@0{
		compatible = "himax,hx8357d";
		reg = <0>;

		spi-max-frequency = <32000000>;
		rotate = <90>;
		fps = <25>;
		bgr;
		buswidth = <8>;
		dc-gpios = <&gpio0 8 0>;
		debug = <0>;
	};

	pitft_ts@1 {
		#address-cells = <1>;
		#size-cells = <0>;
		compatible = "st,stmpe610";
		reg = <1>;
		spi-cpol;

		spi-max-frequency = <1000000>;
		irq-gpio = <&gpio0 9 0x2>; /* IRQF_TRIGGER_FALLING */
		interrupts = <9 2>; /* high-to-low edge triggered */
		interrupt-parent = <&gpio0>;
		interrupt-controller;

		stmpe_touchscreen {
			compatible = "st,stmpe-ts";
			st,sample-time = <4>;
			st,mod-12b = <1>;
			st,ref-sel = <0>;
			st,adc-freq = <2>;
			st,ave-ctrl = <3>;
			st,touch-det-delay = <4>;
			st,settling = <2>;
			st,fraction-z = <7>;
			st,i-drive = <0>;
		};

		stmpe_gpio: stmpe_gpio {
			#gpio-cells = <2>;
			compatible = "st,stmpe-gpio";
			/*
			 * only GPIO2 is wired/available
			 * and it is wired to the backlight
			 */
			st,norequest-mask = <0x7b>;
		};
	};
};

/{
	backlight {
		compatible = "gpio-backlight";
		gpios = <&stmpe_gpio 2 0>;
		default-on;
	};

	fixedreg33: fixed33@0 {
		compatible = "regulator-fixed";
		regulator-name = "fixed-supply";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
	};
};
